<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <!-- This file has been downloaded from Bootsnipp.com. Enjoy! -->
    <title>IoT Tension Sensor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
        body {
            background-color: #525252;
        }
        
        .centered-form {
            margin-top: 24%;
        }
        
        .centered-form .panel {
            background: rgba(255, 255, 255, 0.8);
            box-shadow: rgba(0, 0, 0, 0.3) 20px 20px 20px;
        }
    </style>
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="row centered-form">
            <div class="col-xs-12 col-sm-8 col-md-4 col-sm-offset-2 col-md-offset-4">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Login</h3>

                        <div class="text-danger wrapper text-center" id="messages"></div>
                        <div class="text-success wrapper text-center" id="success"></div>
                    </div>
                    <div class="panel-body">
                        <form role="form">
                            <!-- <div class="form-group">
                                <input type="text" name="mac_address" id="mac_address" class="form-control input-sm" placeholder="MacAddress" disabled>
                            </div> -->
                            <!-- <div class="row">
                                <div class="col-xs-6 col-sm-6 col-md-6">
                                    <div class="form-group">
                                        <input type="text" name="first_name" id="first_name" class="form-control input-sm" placeholder="First Name">
                                    </div>
                                </div>
                                <div class="col-xs-6 col-sm-6 col-md-6">
                                    <div class="form-group">
                                        <input type="text" name="last_name" id="last_name" class="form-control input-sm" placeholder="Last Name">
                                    </div>
                                </div>
                            </div> -->

                            <div class="form-group">
                                <input type="email" name="user" id="user" class="form-control input-sm" placeholder="Email Address">
                            </div>

                            <!-- <div class="row"> -->
                                <!-- <div class="col-xs-8 col-sm-8 col-md-8"> -->
                                    <div class="form-group">
                                        <input type="password" name="pwd" id="pwd" class="form-control input-sm" placeholder="Password">
                                    </div>
                                <!-- </div> -->
                                <!-- <div class="col-xs-6 col-sm-6 col-md-6">
                                    <div class="form-group">
                                        <input type="password" name="password_confirmation" id="password_confirmation" class="form-control input-sm" placeholder="Confirm Password">
                                    </div>
                                </div> -->
                            <!-- </div> -->

                            <input type="button" id="login" value="login" class="btn btn-info btn-block">

                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
    </script>
</body>
<script>
    var encode = document.getElementById('encode'),
        decode = document.getElementById('decode'),
        login = document.getElementById('login'),
        signIn = document.getElementById('user'),
        pwd = document.getElementById('password');

        login.onclick = function() {
        ajaxsave()
        }

        var Base64 = {


_keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",


encode: function(pwd) {
var output = "";
var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
var i = 0;

pwd = Base64._utf8_encode(pwd);

while (i < pwd.length) {

    chr1 = pwd.charCodeAt(i++);
    chr2 = pwd.charCodeAt(i++);
    chr3 = pwd.charCodeAt(i++);

    enc1 = chr1 >> 2;
    enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
    enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
    enc4 = chr3 & 63;

    if (isNaN(chr2)) {
        enc3 = enc4 = 64;
    } else if (isNaN(chr3)) {
        enc4 = 64;
    }

    output = output + this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) + this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4);

}

return output;
},


decode: function(pwd) {
var output = "";
var chr1, chr2, chr3;
var enc1, enc2, enc3, enc4;
var i = 0;

pwd = pwd.replace(/[^A-Za-z0-9\+\/\=]/g, "");

while (i < pwd.length) {

    enc1 = this._keyStr.indexOf(pwd.charAt(i++));
    enc2 = this._keyStr.indexOf(pwd.charAt(i++));
    enc3 = this._keyStr.indexOf(pwd.charAt(i++));
    enc4 = this._keyStr.indexOf(pwd.charAt(i++));

    chr1 = (enc1 << 2) | (enc2 >> 4);
    chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
    chr3 = ((enc3 & 3) << 6) | enc4;

    output = output + String.fromCharCode(chr1);

    if (enc3 != 64) {
        output = output + String.fromCharCode(chr2);
    }
    if (enc4 != 64) {
        output = output + String.fromCharCode(chr3);
    }

}

output = Base64._utf8_decode(output);

return output;

},

_utf8_encode: function(string) {
string = string.replace(/\r\n/g, "\n");
var utftext = "";

for (var n = 0; n < string.length; n++) {

    var c = string.charCodeAt(n);

    if (c < 128) {
        utftext += String.fromCharCode(c);
    } else if ((c > 127) && (c < 2048)) {
        utftext += String.fromCharCode((c >> 6) | 192);
        utftext += String.fromCharCode((c & 63) | 128);
    } else {
        utftext += String.fromCharCode((c >> 12) | 224);
        utftext += String.fromCharCode(((c >> 6) & 63) | 128);
        utftext += String.fromCharCode((c & 63) | 128);
    }

}

return utftext;
},

_utf8_decode: function(utftext) {
var string = "";
var i = 0;
var c = c1 = c2 = 0;

while (i < utftext.length) {

    c = utftext.charCodeAt(i);

    if (c < 128) {
        string += String.fromCharCode(c);
        i++;
    } else if ((c > 191) && (c < 224)) {
        c2 = utftext.charCodeAt(i + 1);
        string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
        i += 2;
    } else {
        c2 = utftext.charCodeAt(i + 1);
        c3 = utftext.charCodeAt(i + 2);
        string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
        i += 3;
    }

}

return string;
}

}



     function ajaxsave() {

            const username = $('#user').val();

            var settings = {
            "url": "https://yl5whaa4v4.execute-api.ap-southeast-2.amazonaws.com/vts/forms/" + username,
            "method": "GET",
            "timeout": 0,
            };
            $.ajax(settings).done(function (response) {

                console.log(response);

                // console.log(response);
            if(response.email){
            console.log(Base64.decode(response.password));
            // var lsrole = 0;
            var decodedPwd = Base64.decode(response.password);
            var mac = response.macAddress;
            // var role = response.role;
            var signInPwd = $('#pwd').val();
            console.log(signInPwd);
            // console.log(response.id);
            // sessionStorage.setItem("state", 1);
            // sessionStorage.setItem("mac", mac);
            // window.location.href = './index.html';
            if (signInPwd == decodedPwd){
                sessionStorage.setItem("state", 1);
                sessionStorage.setItem("mac", mac);
                console.log("You're in!");
                window.location.href = './index.html';
                document.getElementById("success").innerHTML = "You're in'!";

            } else {
                document.getElementById("messages").innerHTML = "Your password is incorrect!";
            }
            } 
            // else if(response.username && response.password && !response.role){
            //     document.getElementById("messages").innerHTML = "Kindly contact the administrator for your authorization";
            // }
            else if(!response.email && !response.password) {
                document.getElementById("messages").innerHTML = "Your account is not registered";
                }

            });
        }
</script>

</html>

